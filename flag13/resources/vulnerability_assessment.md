## Flag 13 – Self-contained XSS via `data:` URI

**URL:**  
`http://127.0.0.1:8000/index.php?page=media&src=data:text/html;base64,PHNjcmlwdD5hbGVydCgnaGknKTwvc2NyaXB0Pg==`

**Decoded payload:**  
    <script>alert('hi')</script>

**Description:**  
This challenge demonstrates a **self-contained, non-persistent XSS** attack using the `data:` URI scheme — a vector explored in depth by security researcher pdp in a 2006 article.

Instead of relying on vulnerable server-side code to reflect a script, this method encodes an entire malicious HTML document as a `data:` URI. When the application uses unvalidated user input as the source (`src`) of an iframe or media container, the browser decodes and renders this document directly, executing any included JavaScript.

**Why it works:**  
- Browsers treat `data:` URIs as legitimate document sources.
- If user input is directly injected into a `src` attribute (e.g. `iframe` or `img`), no server-side reflection is needed.
- The payload is *self-contained*: it carries both the attack vector and the script.
- These URIs bypass many legacy XSS filters, especially those looking for `<script>` tags or suspicious characters in URL parameters.
- The entire attack is embedded in a **single, encoded URL**, making it stealthy and portable (e.g. sharable via email or in RSS feeds).

This doesn't require the server to echo or store anything — it only needs to *use* a user-supplied URI.

**Impact:**  
Such attacks are dangerous because they:
- Do not leave traces on the server.
- May evade detection by WAFs and filters expecting classical reflective or stored XSS patterns.
- Work in browsers that support `data:` in `src`, like Firefox and Opera (not IE6/7).

**OWASP Top 10 Mapping:**  
- **A03:2021 – Injection**  
  (Client-side injection using unsanitized input into HTML context)
- **A07:2021 – Identification and Authentication Failures** *(if leveraged to steal session tokens)*

**Mitigation & Prevention:**  
- Validate and sanitize user-supplied input before using it as a resource URI.
- Disallow `data:` URIs in `src` unless absolutely necessary.
- Use a **Content Security Policy (CSP)** that blocks `data:` as a source:

      Content-Security-Policy: default-src 'self'; script-src 'self'; object-src 'none';

- Avoid dynamically generating `iframe`, `img`, or other media containers from untrusted input.

**Flag:**  
`928d819fc19405ae09921a2b71227bd9aba106f9d2d37ac412e9e5a750f1506d`
