## Breach 06 – Arbitrary File Write via Insecure Upload Mechanism

**Vulnerability:**  
The file upload functionality allows directory traversal through the `filename` field, enabling unauthorized writes to arbitrary locations on the server's filesystem.

**OWASP Top 10 Mapping:**  
**A05:2021 – Security Misconfiguration**  
This includes improper file handling, lack of upload sanitization, and insecure path resolution.

**Exploitation:**  
- Navigated to the upload page:
  ```
  http://127.0.0.1:8000/?page=upload
  ```
- Uploaded a small, valid image file and intercepted the HTTP request.
- Modified the `filename` field in the multipart payload to perform path traversal:
  ```
  ../../../../etc/passwd
  ```
- Ensured that the file content was still a valid JPEG header (to pass client-side checks).
- Sent the modified request:
  ```http
  POST /?page=upload HTTP/1.1
  Host: 127.0.0.1:8000
  ...
  Content-Disposition: form-data; name="uploaded"; filename="../../../../etc/passwd"
  Content-Type: image/jpeg
  ```
- The server accepted the file and returned a flag in response.

**Prevention:**  
- Sanitize filenames on the server side and reject any path traversal sequences (e.g., `../`).
- Store uploaded files using randomized server-side filenames, ignoring user-supplied names.
- Limit upload destinations and enforce strict MIME type checks and file extension validation.
- Run the web server with restricted file system permissions to minimize impact.

**Flag:**  
46910d9ce35b385885a9f7e2b336249d622f29b267a1771fbacf52133beddba8